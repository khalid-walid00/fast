<section class="hero-bg overflow-hidden">
  {% if widget.blocks.length > 0 %}
    <div class="hero-swiper swiper relative max-md:min-h-[282px]" data-bg="{{ widget.blocks[0].data.text_section_background_color | default('#B9C1B6') }}">
      <div class="swiper-wrapper">
        {% set heroTitleKeys = ['elegant_furniture_title','exclusive_offers_title','guaranteed_quality_title'] %}
        {% set heroSubtitleKeys = ['discover_collection_subtitle','discounts_subtitle','high_quality_subtitle'] %}
        {% set defaultHeroImages = [
          'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?auto=format&fit=crop&w=1600&q=80',
          'https://images.unsplash.com/photo-1524758631624-e2822e304c36?auto=format&fit=crop&w=1600&q=80',
          'https://images.unsplash.com/photo-1501045661006-fcebe0257c3f?auto=format&fit=crop&w=1600&q=80'
        ] %}

        {% for block in widget.blocks %}
        <div class="swiper-slide" data-slide-index="{{ loop.index }}" data-bg="{{ block.data.text_section_background_color | default('#B9C1B6') }}">
          <div class="hero-split-container flex flex-col md:flex-row" data-slide="{{ loop.index }}">
            
            <!-- النص -->
            <div class="hero-text-section w-full md:flex-1 flex flex-col justify-center items-center md:items-start relative order-2 {% if t('dir') == 'rtl' %}md:order-1{% else %}md:order-1{% endif %}" 
              style="background-color: {{ block.data.text_section_background_color | default('#B9C1B6') }};">
              <div class="container mx-auto px-4 md:px-8 lg:px-16 py-8 md:py-0">
                <div class="text-center md:{% if t('dir') == 'rtl' %}text-right{% else %}text-left{% endif %} w-full flex flex-col md:gap-12 gap-8">
                  <div class="flex flex-col md:gap-5 gap-3">
                    {% set titleText = block.data.title %}
                    {% set subtitleText = block.data.subtitle %}
                    <h1 class="md:text-[40px] md:leading-[60px] text-[24px] leading-[32px] font-bold md:font-extrabold text-secondary text-center md:{% if t('dir') == 'rtl' %}text-right{% else %}text-left{% endif %} w-full hero-title-main">
                      {{ t(titleText) if titleText else t(heroTitleKeys[loop.index0] or 'hero_title_default') }}
                    </h1>
                    <p class="md:text-[24px] text-sm md:leading-[36px] leading-[20px] text-secondary text-center md:{% if t('dir') == 'rtl' %}text-right{% else %}text-left{% endif %} w-full hero-balance">
                      {{ t(subtitleText) if subtitleText else t(heroSubtitleKeys[loop.index0] or 'hero_subtitle_default') }}
                    </p>
                  </div>
                  <a href="{{ block.data.link | default('/collections') }}" 
                    class="flex items-center justify-center h-[52px] bg-white rounded-lg text-secondary w-full md:text-base text-sm text-center md:font-bold font-semibold hover:bg-gray-50 transition-colors duration-200">
                    {{ t(block.data.button_text or 'shop_now') }}
                  </a>
                </div>
              </div>
            </div>
            
            <!-- الصورة -->
            <div class="hero-image-section w-full md:flex-1 relative order-1 {% if t('dir') == 'rtl' %}md:order-2{% else %}md:order-2{% endif %}" 
              style="background: transparent; padding: 0; margin: 0; display: block; z-index: 1;">
              {% set imageUrl = defaultHeroImages[loop.index0] %}
              {% if block.data.image %}
                {% if block.data.image.fileUrl %}
                  {% set imageUrl = block.data.image.fileUrl %}
                {% elseif block.data.image is string and block.data.image|length > 0 %}
                  {% set imageUrl = block.data.image %}
                {% endif %}
              {% endif %}
              <img src="{{ imageUrl }}" 
                alt="{{ t(block.data.alt | default('hero_image_alt')) }}" 
                class="hero-split-image w-full h-full block" 
                style="width: 100% !important; height: 100% !important; min-height: 300px; object-fit: cover; margin: 0; padding: 0; display: block !important; visibility: visible !important; opacity: 1 !important;">
            </div>
          </div>
        </div>
        {% endfor %}
      </div>

      {% if widget.data.show_pagination %}
        <div class="swiper-pagination"></div>
      {% endif %}
    </div>

    <style>
      /* ===== نقاط السلايدر ===== */
      .hero-swiper .swiper-pagination .swiper-pagination-bullet {
        width: 12px !important;
        height: 12px !important;
        background: #000000 !important;
        opacity: 0.3 !important;
        margin: 0 6px !important;
        border-radius: 50% !important;
        border: 2px solid #000000 !important;
        transition: all 0.3s ease !important;
      }
      .hero-swiper .swiper-pagination .swiper-pagination-bullet-active {
        background: #000000 !important;
        opacity: 1 !important;
        transform: scale(1.2) !important;
        border: 3px solid #000000 !important;
      }
      .hero-swiper .swiper-pagination {
        bottom: 20px !important;
        position: absolute !important;
        z-index: 10 !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
        width: auto !important;
      }

      /* ===== تحسين الموبايل ===== */
      @media (max-width: 767px) {
        .hero-split-container {
          flex-direction: column !important;
          background: transparent !important;
        }

        .hero-image-section {
          order: 1 !important;
          width: 100% !important;
          height: 50vh !important;
          min-height: 250px !important;
          max-height: 50vh !important;
          background: transparent !important;
          z-index: 10 !important;
        }

        .hero-image-section img {
          width: 100% !important;
          height: 100% !important;
          object-fit: cover !important;
          opacity: 1 !important;
          visibility: visible !important;
          display: block !important;
          position: relative !important;
        }

        .hero-text-section {
          order: 2 !important;
          position: relative !important;
          z-index: 5 !important;
          background-color: var(--mobile-bg, #B9C1B6) !important;
          padding: 20px 16px !important;
          min-height: 200px !important;
          max-height: 200px !important;
          height: 200px !important;
          text-align: center !important;
        }

        .hero-text-section .container {
          height: 100% !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
        }

        .hero-text-section > div > div {
          width: 100% !important;
          max-width: 100% !important;
        }

        .hero-title-main {
          text-align: center !important;
          font-size: 18px !important;
          line-height: 24px !important;
          margin-bottom: 8px !important;
        }

        .hero-balance {
          text-align: center !important;
          font-size: 13px !important;
          line-height: 18px !important;
          margin-bottom: 12px !important;
        }

        .hero-text-section a {
          width: 85% !important;
          max-width: 85% !important;
          margin: 0 auto !important;
          font-size: 15px !important;
          height: 50px !important;
          font-weight: bold !important;
        }

        .swiper-slide {
          display: block !important;
          opacity: 1 !important;
          visibility: visible !important;
        }

        .hero-swiper {
          background: none !important;
          background-color: transparent !important;
        }
      }
    </style>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const heroSwiper = new Swiper('.hero-swiper', {
          loop: true,
          speed: 900,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          autoplay: {
            delay: 4000,
            disableOnInteraction: false,
          },
          on: {
            init: function() {
              const slides = document.querySelectorAll('.hero-split-image');
              slides.forEach(img => {
                if (img.complete) {
                  img.style.opacity = '1';
                } else {
                  img.addEventListener('load', () => {
                    img.style.opacity = '1';
                  });
                }
              });
            },
          }
        });

        // تأكيد ظهور الصور في الموبايل دائمًا
        const imgs = document.querySelectorAll('.hero-split-image');
        imgs.forEach(img => {
          if (img.complete) {
            img.style.opacity = '1';
            img.style.visibility = 'visible';
          } else {
            img.addEventListener('load', () => {
              img.style.opacity = '1';
              img.style.visibility = 'visible';
            });
          }
        });

        // تثبيت الصور عند تغيير المقاس
        window.addEventListener('resize', () => {
          if (window.innerWidth <= 767) {
            imgs.forEach(img => {
              img.style.opacity = '1';
              img.style.visibility = 'visible';
              img.parentElement.style.display = 'block';
            });
          }
        });
      });
    </script>

  {% else %}
    <!-- Fallback -->
    <div class="hero-split-container flex flex-col md:flex-row" data-slide="1">
      <div class="hero-text-section w-full md:flex-1 flex flex-col justify-center relative order-2" style="background-color: #B9C1B6;">
        <div class="container mx-auto px-4 md:px-8 lg:px-16 py-8 md:py-0 text-center">
          <h1 class="text-[34px] md:text-[40px] font-bold text-secondary">أثاث أنيق لمنزلك العصري</h1>
          <p class="text-sm md:text-[24px] text-secondary">اكتشف تشكيلتنا الواسعة من الأثاث بتصاميم عصرية وجودة عالية</p>
          <a href="/collections" class="flex items-center justify-center h-[56px] bg-white rounded-lg text-secondary w-[90%] md:max-w-[438px] mx-auto md:font-bold font-semibold hover:bg-gray-50 transition-colors duration-200 mt-4">تسوق الآن</a>
        </div>
      </div>
      <div class="hero-image-section w-full md:flex-1 relative order-1" style="background: transparent;">
        <img src="https://images.unsplash.com/photo-1484101403633-562f891dc89a?auto=format&fit=crop&w=1600&q=80" alt="كرسي مع وسادة وخلفية أنيقة" class="hero-split-image w-full h-full" style="object-fit: cover;">
      </div>
    </div>
  {% endif %}
</section>
