<!-- Header & Interactive Modals Controller -->
<div class="sticky top-0 left-0 right-0 z-50 bg-white border-b border-[#E9E9E9] w-full">
    <header class="container py-1.5 md:py-4 flex items-center gap-8 justify-between">
        <div class="flex items-center gap-8">
            <a href="/">
                <img src="{{ globals.app.logo.fileUrl }}" alt="logo" class="md:w-[50px] md:h-[43px] w-11  "></a>
                <div class="relative hidden md:flex items-center w-full min-w-0">
                    <nav class="flex items-center justify-center gap-x-5  w-max">
                        {% set items = widget.data.header_menu or [] %}
                        {% for item in items %}
                            {% if loop.index0 < 6 %}
                                <a href="{{ item.url | default('#') }}" class="text-secondary hover:text-primary whitespace-nowrap transition-colors duration-200 {% if item.url == globals.currentUrl %}active font-bold text-primary{% else %}font-normal{% endif %}">
                                    {{ item.title | default(t('no_title')) }}</a>
                            {% endif %}
                        {% endfor %}
                        {% if items | length > 6 %}
                            <div class="relative group flex items-center">
                                <button class=" hover:text-primary justify-center rounded-md flex items-center gap-2  " aria-label="المزيد">
                                    <span class="font-semibold">
                                        {{ t('more') }}
                                    </span>
                                    <span class="material-symbols-outlined">
                                        arrow_drop_down
                                    </span>
                                </button>
                                <div class="absolute top-full mt-2 right-0 bg-white border border-gray-200 rounded-lg shadow-lg py-2 z-50 min-w-[12rem]
                                        opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
                                    {% for item in items %}
                                        {% if loop.index0 >= 6 %}
                                            <a href="{{ item.url | default('#') }}" class="block px-4 py-2  text-gray-600 hover:text-primary hover:bg-gray-50 whitespace-nowrap {% if item.url == globals.currentUrl %}active font-bold text-primary{% else %}font-normal{% endif %}">{{ item.title | default(t('no_title')) }}</a>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                        {% endif %}
                    </nav>
                </div>
            </div>
            <div class="items-center hidden xl:flex border border-strok flex-1 gap-3.5 rounded-lg py-[5px]  ">
                <form @submit.prevent="setSearch(search)" class="w-7/12 md:flex flex-1 hidden items-center gap-5">
                    <button
                        type="submit"
                        class=" pl-[18px] cursor-pointer transform {% if t('dir') == 'rtl' %}-scale-x-100{% endif %} material-symbols-outlined text-xl
                            text-strok flex items-center justify-center w-5 h-5">
                        search
                    </button>
                    
                    <input v-model="search" ref="search" type="text" placeholder="{{ t('search_here') }}" class="placeholder-[#9CA3AF] placeholder-opacity-100 py-[2px] flex-1 focus:outline-none rounded-lg bg-white text-primary" style="font-family: Changa; font-weight: 400; font-style: normal; font-size: 14px; line-height: 100%; text-align: right; letter-spacing: 0;"></form>
                </div>
                <div class=" items-center hidden xl:flex gap-[14px] ">
                    <button @click="toggleModal('cart')" class="flex items-center rounded-lg bg-primary gap-1.5 py-2 px-4">
                        <div class="relative flex items-center">
                            <span
                                v-text="globals?.cart?.items?.length || 0"
                                class="rounded-full text-primary w-3 h-3 bg-white absolute -top-1 -right-1 text-[10px] font-bold flex items-center
                                    justify-center leading-none"></span>
                            <span class="material-symbols-outlined text-xl text-white flex items-center justify-center w-5 h-5">
                                shopping_cart
                            </span>
                        </div>
                        <div class="flex items-center">
                            <span v-text="globals.cart.totalPrice || 0" class="font-semibold text-nowrap text-white text-xs"></span>
                            <span v-text="globals?.currency?.currencySymbol" class="font-semibold text-nowrap text-white text-xs mr-1"></span>
                        </div>
                    </button>
                    {% if globals.customer._id %}
                        <button @click="logout()" class="flex items-center rounded-lg bg-[#E6E6E6] gap-1.5 py-2 px-4">
                            <span class="material-symbols-outlined text-xl text-secondary flex items-center justify-center w-5 h-5">
                                person
                            </span>
                            <span
                                class="font-semibold text-secondary text-nowrap text-xs"
                                style="font-family: Changa; font-weight: 600; font-style: normal; font-size: 12px; line-height: 100%; letter-spacing: 0;
                                    text-align: right;">{{ t('login') }}</span>
                        </button>
                    {% else %}
                        <button @click="login()" class="flex items-center rounded-lg bg-[#E6E6E6] gap-1.5 py-2 px-4">
                            <span class="material-symbols-outlined text-xl text-secondary flex items-center justify-center w-5 h-5">
                                person
                            </span>
                            <span
                                class="font-semibold text-secondary text-nowrap text-xs"
                                style="font-family: Changa; font-weight: 600; font-style: normal; font-size: 12px; line-height: 100%; letter-spacing: 0;
                                    text-align: right;">{{ t('login') }}</span>
                        </button>
                        <div class="relative group flex items-center">
                            <button
                                class="flex items-center rounded-lg min-h-9 bg-[#424242] gap-1.5 py-1.5 px-2.5 hover:bg-[#505050] transition-all duration-200"
                                aria-label="تغيير اللغة">
                                <img class="w-4 h-4 object-contain" src="{{ 'ar.png' | assets }}"/>
                                <span class="text-sm text-white font-semibold flex items-center justify-center">
                                    العربية
                                </span>
                            </button>
                            <div class="absolute top-full mt-2 right-0 bg-white border border-gray-200 rounded-lg border-stoke  overflow-hidden z-50 min-w-[150px]
                                    opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
                                <button
                                    onclick="switchLang('ar')"
                                    class=" w-full flex items-center gap-1.5 px-4 py-2 text-sm text-gray-700 hover:text-white hover:bg-primary">
                                    <img class="w-4 h-4 object-contain" src="{{ 'ar.png' | assets }}"/>
                                    <span class="text-sm flex items-center justify-center">
                                        العربية
                                    </span>
                                </button>
                                <button
                                    onclick="switchLang('en')"
                                    class=" w-full flex items-center gap-1.5 px-4 py-2 text-sm text-gray-700 hover:text-white   hover:bg-primary">
                                    <img class="w-4 h-4 object-contain" src="{{ 'en.png' | assets }}"/>
                                    <span class="text-sm flex items-center  justify-center">
                                        English
                                    </span>
                                    </button>
                            </div>
                        </div>
                    {% endif %}
                </div>
                <div class=" max-xl:flex hidden items-center gap-4">
                    <button
                        @click="toggleModal('search')"
                        class="material-symbols-outlined text-xl text-black  flex items-center justify-center w-5 h-5">
                        search
                    </button>
                    <div class=" relative flex items-center">
                        <span
                            v-text="globals?.cart?.items?.length"
                            class=" rounded-full bg-primary absolute -top-1 text-white -right-1 text-[10px] font-bold flex items-center
                                justify-center w-3 h-3"></span>
                        <button
                            @click="toggleModal('cart')"
                            class="material-symbols-outlined text-xl text-black flex items-center justify-center w-5 h-5">
                            shopping_cart
                        </button>
                    </div>
                    <button
                        @click="toggleModal('sidebar')"
                        class="material-symbols-outlined text-xl text-black flex items-center justify-center w-5 h-5">
                        menu
                    </button>
                </div>
            </header>
        </div>
        {% ui "sidebar.njk", menu=widget.data.header_menu %}
        {% ui "search.njk" %}
        {% ui "cart.njk" %}