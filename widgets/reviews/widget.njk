<section class="py-8 bg-white">
  <div class="container ">
    <style>
      /* Mobile reviews slider paddings and arrow layering */
      .reviews-swiper .swiper-wrapper { align-items: stretch; }
      .reviews-swiper .swiper-slide { padding-inline: 8px; }
      .reviews-swiper .nav-btn { z-index: 10; }
    </style>

    <div class="section-title-container md:mb-10 mb-4">
      <h2 class="section-title">{{ t('customer_reviews') }}</h2>
    </div>
   {# <span class=" text-4xl text-red-600">{{ t(widget.data.test) }}</span> #}
    {% if widget.blocks.length > 0 %}
      {% set reviewNameKeys = ['ahmed_karam','sara_mohammed','khaled_abdullah'] %}
      {% set reviewTextKeys = ['excellent_experience_review','fast_shipping_review','reasonable_prices_review'] %}
      <!-- Mobile Swiper -->
      <div class="md:hidden swiper reviews-swiper relative">
        <div class="swiper-wrapper">
          {% for block in widget.blocks %}
          <div class="swiper-slide">
            <div class="review-card">
              <span class="material-symbols-outlined review-quote">format_quote</span>
              {% set rating = block.data.stars or 4 %}
              <div class="review-score absolute top-3 {% if t('dir') == 'rtl' %}left-4{% else %}right-4{% endif %} flex items-center gap-1">
                <span class="star">★</span>
                <span class="text-gray-700 text-sm">{{ rating }}</span>
              </div>
              <p class="review-text">{{ t(reviewTextKeys[loop.index0] or 'default_review_text') }}</p>
              <div class="review-footer">
                {% if block.data.image and block.data.image.fileUrl %}
                  <img src="{{ block.data.image.fileUrl }}" alt="{{ t('customer_image') }}" class="review-avatar">
                {% else %}
                  <img src="https://i.pravatar.cc/48?u={{ block.data.name | urlencode }}" alt="{{ t('customer_image') }}" class="review-avatar">
                {% endif %}
                <span class="review-name">{{ t(reviewNameKeys[loop.index0] or 'default_customer_name') }}</span>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>

        <div class="swiper-pagination"></div>

        <button class="nav-btn nav-prev" aria-label="{{t('previous')}}">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
          </svg>
        </button>

        <button class="nav-btn nav-next" aria-label="{{t('next')}}">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path d="m8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"/>
          </svg>
        </button>
      </div>
      
      <script>
        document.addEventListener('DOMContentLoaded', function() {
          const reviewsSwiper = new Swiper('.reviews-swiper', {
            slidesPerView: 1,
            spaceBetween: 16,
            centeredSlides: true,
            loop: true,
            autoplay: {
              delay: 5000,
              disableOnInteraction: false,
            },
            pagination: {
              el: '.reviews-swiper .swiper-pagination',
              clickable: true,
            },
            navigation: {
              nextEl: '.reviews-swiper .nav-next',
              prevEl: '.reviews-swiper .nav-prev',
            },
            breakpoints: {
              640: {
                slidesPerView: 1.5,
                spaceBetween: 20,
              },
              768: {
                slidesPerView: 2,
                spaceBetween: 24,
              },
            },
          });
        });
      </script>

      <!-- Desktop Grid -->
      <div class="hidden md:grid grid-cols-1 md:grid-cols-3 gap-5 md:gap-5">
        {% for block in widget.blocks %}
        <div class="review-card">
          <span class="material-symbols-outlined review-quote">format_quote</span>
          {% set rating = block.data.stars or 4 %}
          <div class="review-score absolute top-3 left-4 flex items-center gap-1">
            <span class="star">★</span>
            <span class="text-gray-700 text-sm">{{ rating }}</span>
          </div>
          <p class="review-text">{{ t(reviewTextKeys[loop.index0] or 'default_review_text') }}</p>
          <div class="review-footer">
            {% if block.data.image and block.data.image.fileUrl %}
              <img src="{{ block.data.image.fileUrl }}" alt="{{ t('customer_image') }}" class="review-avatar">
            {% else %}
              <img src="https://i.pravatar.cc/48?u={{ block.data.name | urlencode }}" alt="{{ t('customer_image') }}" class="review-avatar">
            {% endif %}
            <span class="review-name">{{ t(reviewNameKeys[loop.index0] or 'default_customer_name') }}</span>
          </div>
        </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>
</section>
